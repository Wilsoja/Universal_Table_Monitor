
CREATE TABLE MONITORING_CONFIG (
CONFIG_ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
TABLE_SCHEMA NVARCHAR(256) NOT NULL,
TABLE_NAME NVARCHAR(256) NOT NULL,
SME_EMAIL NVARCHAR(500) NOT NULL,
SME_NAME NVARCHAR(256),
MONITOR_SCHEMA_CHANGES CHAR(1) DEFAULT 'Y',
MONITOR_DATA_CHANGES CHAR(1) DEFAULT 'Y',
DATA_CHANGE_THRESHOLD INTEGER DEFAULT 100,
CHECK_FREQUENCY_MINUTES INTEGER DEFAULT 30,
IS_ACTIVE CHAR(1) DEFAULT 'Y',
TRACK_DETAILED_CHANGES CHAR(1) DEFAULT 'N',
MAX_ROWS_FOR_DETAILED_TRACKING INTEGER DEFAULT 10000,
SAMPLE_PERCENTAGE DECIMAL(5,2) DEFAULT 100.00,
CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
LAST_MODIFIED TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Table to store baseline schema information
CREATE TABLE TABLE_SCHEMA_BASELINE (
BASELINE_ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
TABLE_SCHEMA NVARCHAR(256) NOT NULL,
TABLE_NAME NVARCHAR(256) NOT NULL,
COLUMN_NAME NVARCHAR(256) NOT NULL,
ORDINAL_POSITION INTEGER,
DATA_TYPE_NAME NVARCHAR(128),
LENGTH INTEGER,
SCALE INTEGER,
IS_NULLABLE CHAR(5),
DEFAULT_VALUE NVARCHAR(5000),
COMMENTS NVARCHAR(5000),
CONSTRAINT_TYPE NVARCHAR(32),
SNAPSHOT_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
UNIQUE(TABLE_SCHEMA, TABLE_NAME, COLUMN_NAME)
);

-- Table to store data change baselines (row counts, checksums)
CREATE TABLE TABLE_DATA_BASELINE (
BASELINE_ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
TABLE_SCHEMA NVARCHAR(256) NOT NULL,
TABLE_NAME NVARCHAR(256) NOT NULL,
ROW_COUNT BIGINT,
DATA_CHECKSUM NVARCHAR(32),
LAST_UPDATE_TIME TIMESTAMP,
SNAPSHOT_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
UNIQUE(TABLE_SCHEMA, TABLE_NAME)
);

-- Enhanced table to store detailed row-level baselines for change tracking
CREATE TABLE TABLE_ROW_BASELINE (
BASELINE_ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
TABLE_SCHEMA NVARCHAR(256) NOT NULL,
TABLE_NAME NVARCHAR(256) NOT NULL,
ROW_KEY_HASH NVARCHAR(64) NOT NULL,
ROW_DATA_HASH NVARCHAR(64) NOT NULL,
ROW_DATA_JSON NCLOB,
SNAPSHOT_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
UNIQUE(TABLE_SCHEMA, TABLE_NAME, ROW_KEY_HASH)
);

-- Table to store primary key column information for each monitored table
CREATE TABLE TABLE_KEY_COLUMNS (
TABLE_SCHEMA NVARCHAR(256) NOT NULL,
TABLE_NAME NVARCHAR(256) NOT NULL,
COLUMN_NAME NVARCHAR(256) NOT NULL,
ORDINAL_POSITION INTEGER,
IS_PRIMARY_KEY CHAR(1) DEFAULT 'N',
IS_UNIQUE_KEY CHAR(1) DEFAULT 'N',
CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
UNIQUE(TABLE_SCHEMA, TABLE_NAME, COLUMN_NAME)
);

-- Table to log monitoring activities
CREATE TABLE MONITORING_LOG (
LOG_ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
TABLE_SCHEMA NVARCHAR(256),
TABLE_NAME NVARCHAR(256),
CHANGE_TYPE NVARCHAR(50),
CHANGE_DETAILS NCLOB,
SME_NOTIFIED CHAR(1) DEFAULT 'N',
NOTIFICATION_STATUS NVARCHAR(500),
DETECTED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
